<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,LSQ,Galileo,blog" />
    <meta name="generator" content="Maverick 1.1" />
    <meta name="template" content="Galileo" />
    <link rel="alternate" type="application/rss+xml" title="我的个人博客 &raquo; RSS 2.0" href="/Blog/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="我的个人博客 &raquo; ATOM 1.0" href="/Blog/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/assets/galileo-3f4dcc35c9.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/assets/ExSearch/ExSearch-182e5a8868.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/assets/katex.min.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700&display=swap">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/313f26add36d5f1bb18771ec808f67d9.json"
        }
    </script>
    
<title>Centerpoint based 3D Tracking - 我的个人博客</title>
<meta name="author" content="刘胜琪" />
<meta name="description" content="项目学习" />
<meta property="og:title" content="Centerpoint based 3D Tracking - 我的个人博客" />
<meta property="og:description" content="项目学习" />
<meta property="og:site_name" content="我的个人博客" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/Blog/archives/3Dtracking/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2021-09-17T00:00:00-00.00" />
<meta name="twitter:title" content="Centerpoint based 3D Tracking - 我的个人博客" />
<meta name="twitter:description" content="项目学习" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/disqusjs@1.3/dist/disqusjs.css">
<script src="https://cdn.jsdelivr.net/npm/disqusjs@1.3/dist/disqus.js"></script>
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />
<link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/logo.png">
<script type='text/javascript' src="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/assets/jquery-3.4.1.min.js"></script>
<!-- szgotop -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog/gotop/css/szgotop.css" />
<!-- FancyBox -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/assets/jquery.fancybox.min.css" />
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/assets/jquery.fancybox.min.js"></script>
<script>
$(function() {
   $(".yue figure img").each(function(i) {
      if (!this.parentNode.href) {
         $(this).wrap("<a href='" + this.src + "' data-fancybox='images' data-caption='" + this.alt + "'></a>")
      }
   })
});
</script>
<script type="text/javascript">
$( '[data-fancybox]' ).fancybox({
	protect:true,
	caption : function( instance, item ) {
	return $(this).find('figcaption').html();
	}
});
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d69b9b23082b2143a5bce14c4c459baa";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

    </head>
    
    <body>
        
        <div class="container">
            <header id="ga-header">
                <div first>
                    <aside id="ga-brand">
                        <h1 class="brand"><a class="no-style" href="/Blog/">我的个人博客</a></h1>
                        <p>记录生活美好</p>
                    </aside>
                </div>
                <div second id="ga-nav">
                    <nav class="navs">
                        <ul><li><a class="ga-highlight" href="/Blog/" target="_self">首页</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/Blog/archives/" target="_self">归档</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/Blog/about/" target="_self">关于</a></li><span class="separator">·</span><li><a href="#" target="_self" class="search-form-input ga-highlight">搜索</a></li></ul>
                    </nav>
                </div>
            </header>
            <div class="wrapper">
                
<main>    
    <section class="ga-section ga-content">
        <article class="yue">
            <h1 class="ga-post_title">Centerpoint based 3D Tracking</h1>
            <span class="ga-post_meta ga-mono">
                <span>刘胜琪</span>
                <time>
                    2021-09-17
                </time>
                
                in <a no-style class="category" href="/Blog/category/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/">
                    默认分类
                </a>
                
                
            </span>
            <div class="ga-content_body">
                <p><strong>Centerpoint</strong></p><p>voxel网络结构和输出tensor形状</p><p>reader：type=&quot;VoxelFeatureExtractorV3&quot;,取平均</p><p>输入torch.Size([体素数, 10, 5])&quot;features&quot;， torch.Size([体素数])&quot;num_voxels&quot;，输出torch.Size([体素数, 5])input_features</p><p>backbone：type=&quot;SpMiddleResNetFHD&quot;</p><p>输入torch.Size([体素数, 5])，torch.Size([体素数, 4]) coordinate[0,位置坐标]，batch_size:1，data[input_shape]：[1440 1440   40]，输出x.shape：torch.Size([1, 256, 180, 180])，{'conv1': &lt;spconv.SparseConvTensor object at 0x7f8f56e68ef0&gt;, 'conv2': &lt;spconv.SparseConvTensor object at 0x7f8f56e68b70&gt;, 'conv3': &lt;spconv.SparseConvTensor object at 0x7f8f56e68f98&gt;, 'conv4': &lt;spconv.SparseConvTensor object at 0x7f8f56e68d30&gt;} voxel_feature</p><p>neck：type=&quot;RPN&quot;</p><p>输入x.shape：torch.Size([1, 256, 180, 180])，输出x.shape：torch.Size([1, 512, 180, 180])</p><p>bbox_head：type=&quot;CenterHead&quot;</p><p>输入x.shape：torch.Size([1, 512, 180, 180])，输出list为</p><p><strong>[</strong></p><p><strong>{'reg': tensor([1, 2, 180, 180]), 'height': tensor([1, 1, 180, 180]), 'dim': tensor([1, 3, 180, 180]), 'rot': tensor([1, 2, 180, 180]), 'vel': tensor([1, 2, 180, 180]), 'hm': tensor([1, 1, 180, 180])},</strong></p><p><strong>{'reg': tensor([1, 2, 180, 180]), 'height': tensor([1, 1, 180, 180]), 'dim': tensor([1, 3, 180, 180]), 'rot': tensor([1, 2, 180, 180]), 'vel': tensor([1, 2, 180, 180]), 'hm': tensor([1, 2, 180, 180])},</strong></p><p><strong>{'reg': tensor([1, 2, 180, 180]), 'height': tensor([1, 1, 180, 180]), 'dim': tensor([1, 3, 180, 180]), 'rot': tensor([1, 2, 180, 180]), 'vel': tensor([1, 2, 180, 180]), 'hm': tensor([1, 2, 180, 180])},</strong></p><p><strong>{'reg': tensor([1, 2, 180, 180]), 'height': tensor([1, 1, 180, 180]), 'dim': tensor([1, 3, 180, 180]), 'rot': tensor([1, 2, 180, 180]), 'vel': tensor([1, 2, 180, 180]), 'hm': tensor([1, 1, 180, 180])},</strong></p><p><strong>{'reg': tensor([1, 2, 180, 180]), 'height': tensor([1, 1, 180, 180]), 'dim': tensor([1, 3, 180, 180]), 'rot': tensor([1, 2, 180, 180]), 'vel': tensor([1, 2, 180, 180]), 'hm': tensor([1, 2, 180, 180])},</strong></p><p><strong>{'reg': tensor([1, 2, 180, 180]), 'height': tensor([1, 1, 180, 180]), 'dim': tensor([1, 3, 180, 180]), 'rot': tensor([1, 2, 180, 180]), 'vel': tensor([1, 2, 180, 180]), 'hm': tensor([1, 2, 180, 180])}</strong></p><p><strong>]</strong></p><p>output的结果</p><div class="highlight"><pre><span></span><span class="p">[{</span><span class="err">&#39;box</span><span class="mi">3</span><span class="err">d_lidar&#39;</span><span class="p">:</span> <span class="kc">tens</span><span class="err">or(</span><span class="p">[[</span> <span class="mf">9.5765e-01</span><span class="p">,</span> <span class="mf">-8.1574e+00</span><span class="p">,</span> <span class="mf">-1.1584e+00</span><span class="p">,</span>  <span class="err">...</span><span class="p">,</span>  <span class="mf">2.3936e-01</span><span class="p">,</span>
          <span class="mf">1.7465e+00</span><span class="p">,</span> <span class="mf">-3.0140e+00</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">1.0656e+01</span><span class="p">,</span>  <span class="mf">2.0182e+01</span><span class="p">,</span>  <span class="mf">2.1907e-02</span><span class="p">,</span>  <span class="err">...</span><span class="p">,</span>  <span class="mf">1.6337e+00</span><span class="p">,</span>
          <span class="mf">1.6447e+00</span><span class="p">,</span> <span class="mf">-2.3173e+00</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">3.9706e-01</span><span class="p">,</span> <span class="mf">-3.0798e+01</span><span class="p">,</span> <span class="mf">-1.4518e+00</span><span class="p">,</span>  <span class="err">...</span><span class="p">,</span> <span class="mf">-1.4510e-01</span><span class="p">,</span>
          <span class="mf">4.8273e+00</span><span class="p">,</span> <span class="mf">-3.1372e+00</span><span class="p">],</span>
        <span class="err">...</span><span class="p">,</span>
        <span class="p">[</span> <span class="mf">2.1409e+00</span><span class="p">,</span>  <span class="mf">2.1294e+01</span><span class="p">,</span> <span class="mf">-6.0946e-02</span><span class="p">,</span>  <span class="err">...</span><span class="p">,</span>  <span class="mf">7.9199e-09</span><span class="p">,</span>
          <span class="mf">9.7809e-10</span><span class="p">,</span> <span class="mf">-2.8571e+00</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">-1.5230e+01</span><span class="p">,</span>  <span class="mf">1.1139e+01</span><span class="p">,</span> <span class="mf">-6.7530e-01</span><span class="p">,</span>  <span class="err">...</span><span class="p">,</span>  <span class="mf">4.3063e-03</span><span class="p">,</span>
          <span class="mf">1.9419e-04</span><span class="p">,</span> <span class="mf">-3.6318e-01</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">-1.5802e+01</span><span class="p">,</span> <span class="mf">-6.9950e+00</span><span class="p">,</span>  <span class="mf">1.3413e+00</span><span class="p">,</span>  <span class="err">...</span><span class="p">,</span> <span class="mf">-4.8845e-04</span><span class="p">,</span>
          <span class="mf">1.7079e-03</span><span class="p">,</span> <span class="mf">-3.0042e+00</span><span class="p">]],</span> <span class="err">device=&#39;cuda</span><span class="p">:</span><span class="mi">0</span><span class="err">&#39;)</span><span class="p">,</span> <span class="err">&#39;scores&#39;</span><span class="p">:</span> <span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mf">0.8431</span><span class="p">,</span> <span class="mf">0.6624</span><span class="p">,</span> <span class="mf">0.5860</span><span class="p">,</span> <span class="mf">0.5637</span><span class="p">,</span> <span class="mf">0.3287</span><span class="p">,</span> <span class="mf">0.1784</span><span class="p">,</span> <span class="mf">0.1722</span><span class="p">,</span> <span class="mf">0.1657</span><span class="p">,</span> <span class="mf">0.1492</span><span class="p">,</span>
        <span class="mf">0.1128</span><span class="p">,</span> <span class="mf">0.3096</span><span class="p">,</span> <span class="mf">0.2991</span><span class="p">,</span> <span class="mf">0.2722</span><span class="p">,</span> <span class="mf">0.2451</span><span class="p">,</span> <span class="mf">0.2037</span><span class="p">,</span> <span class="mf">0.1750</span><span class="p">,</span> <span class="mf">0.1609</span><span class="p">,</span> <span class="mf">0.1528</span><span class="p">,</span>
        <span class="mf">0.1380</span><span class="p">,</span> <span class="mf">0.1141</span><span class="p">,</span> <span class="mf">0.1139</span><span class="p">,</span> <span class="mf">0.1119</span><span class="p">,</span> <span class="mf">0.1094</span><span class="p">,</span> <span class="mf">0.1057</span><span class="p">,</span> <span class="mf">0.1026</span><span class="p">,</span> <span class="mf">0.1006</span><span class="p">,</span> <span class="mf">0.1001</span><span class="p">,</span>
        <span class="mf">0.1001</span><span class="p">,</span> <span class="mf">0.2855</span><span class="p">,</span> <span class="mf">0.1238</span><span class="p">,</span> <span class="mf">0.1084</span><span class="p">,</span> <span class="mf">0.1011</span><span class="p">,</span> <span class="mf">0.3027</span><span class="p">,</span> <span class="mf">0.2017</span><span class="p">,</span> <span class="mf">0.1995</span><span class="p">,</span> <span class="mf">0.1879</span><span class="p">,</span>
        <span class="mf">0.1484</span><span class="p">,</span> <span class="mf">0.1203</span><span class="p">,</span> <span class="mf">0.1194</span><span class="p">,</span> <span class="mf">0.1112</span><span class="p">,</span> <span class="mf">0.1097</span><span class="p">,</span> <span class="mf">0.1060</span><span class="p">,</span> <span class="mf">0.1019</span><span class="p">,</span> <span class="mf">0.1005</span><span class="p">,</span> <span class="mf">0.3652</span><span class="p">,</span>
        <span class="mf">0.3497</span><span class="p">,</span> <span class="mf">0.2844</span><span class="p">,</span> <span class="mf">0.2724</span><span class="p">,</span> <span class="mf">0.2464</span><span class="p">,</span> <span class="mf">0.2014</span><span class="p">,</span> <span class="mf">0.1862</span><span class="p">,</span> <span class="mf">0.1774</span><span class="p">,</span> <span class="mf">0.1621</span><span class="p">,</span> <span class="mf">0.1597</span><span class="p">,</span>
        <span class="mf">0.1568</span><span class="p">,</span> <span class="mf">0.1543</span><span class="p">,</span> <span class="mf">0.1427</span><span class="p">,</span> <span class="mf">0.1394</span><span class="p">,</span> <span class="mf">0.1370</span><span class="p">,</span> <span class="mf">0.1329</span><span class="p">,</span> <span class="mf">0.1289</span><span class="p">,</span> <span class="mf">0.1259</span><span class="p">,</span> <span class="mf">0.1242</span><span class="p">,</span>
        <span class="mf">0.1232</span><span class="p">,</span> <span class="mf">0.1224</span><span class="p">,</span> <span class="mf">0.1131</span><span class="p">,</span> <span class="mf">0.1129</span><span class="p">,</span> <span class="mf">0.1102</span><span class="p">,</span> <span class="mf">0.1082</span><span class="p">,</span> <span class="mf">0.1037</span><span class="p">,</span> <span class="mf">0.1033</span><span class="p">,</span> <span class="mf">0.1011</span><span class="p">,</span>
        <span class="mf">0.1008</span><span class="p">,</span> <span class="mf">0.1002</span><span class="p">,</span> <span class="mf">0.1001</span><span class="p">,</span> <span class="mf">0.3860</span><span class="p">,</span> <span class="mf">0.3815</span><span class="p">,</span> <span class="mf">0.2732</span><span class="p">,</span> <span class="mf">0.2582</span><span class="p">,</span> <span class="mf">0.2510</span><span class="p">,</span> <span class="mf">0.2181</span><span class="p">,</span>
        <span class="mf">0.2094</span><span class="p">,</span> <span class="mf">0.2045</span><span class="p">,</span> <span class="mf">0.1980</span><span class="p">,</span> <span class="mf">0.1971</span><span class="p">,</span> <span class="mf">0.1832</span><span class="p">,</span> <span class="mf">0.1817</span><span class="p">,</span> <span class="mf">0.1743</span><span class="p">,</span> <span class="mf">0.1688</span><span class="p">,</span> <span class="mf">0.1662</span><span class="p">,</span>
        <span class="mf">0.1655</span><span class="p">,</span> <span class="mf">0.1621</span><span class="p">,</span> <span class="mf">0.1613</span><span class="p">,</span> <span class="mf">0.1432</span><span class="p">,</span> <span class="mf">0.1402</span><span class="p">,</span> <span class="mf">0.1349</span><span class="p">,</span> <span class="mf">0.1346</span><span class="p">,</span> <span class="mf">0.1345</span><span class="p">,</span> <span class="mf">0.1308</span><span class="p">,</span>
        <span class="mf">0.1301</span><span class="p">,</span> <span class="mf">0.1300</span><span class="p">,</span> <span class="mf">0.1275</span><span class="p">,</span> <span class="mf">0.1198</span><span class="p">,</span> <span class="mf">0.1164</span><span class="p">,</span> <span class="mf">0.1160</span><span class="p">,</span> <span class="mf">0.1044</span><span class="p">,</span> <span class="mf">0.1038</span><span class="p">,</span> <span class="mf">0.1027</span><span class="p">,</span>
        <span class="mf">0.1027</span><span class="p">,</span> <span class="mf">0.1019</span><span class="p">,</span> <span class="mf">0.1007</span><span class="p">,</span> <span class="mf">0.1002</span><span class="p">],</span> <span class="err">device=&#39;cuda</span><span class="p">:</span><span class="mi">0</span><span class="err">&#39;)</span><span class="p">,</span> <span class="err">&#39;label_preds&#39;</span><span class="p">:</span> <span class="kc">tens</span><span class="err">or(</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
        <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
        <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>
        <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="err">device=&#39;cuda</span><span class="p">:</span><span class="mi">0</span><span class="err">&#39;)</span><span class="p">,</span> <span class="err">&#39;me</span><span class="kc">ta</span><span class="err">da</span><span class="kc">ta</span><span class="err">&#39;</span><span class="p">:</span> <span class="p">{</span><span class="err">&#39;image_pre</span><span class="kc">f</span><span class="err">ix&#39;</span><span class="p">:</span> <span class="err">PosixPa</span><span class="kc">t</span><span class="err">h(&#39;da</span><span class="kc">ta</span><span class="err">/</span><span class="kc">nu</span><span class="err">Sce</span><span class="kc">nes</span><span class="err">&#39;)</span><span class="p">,</span> <span class="err">&#39;</span><span class="kc">nu</span><span class="err">m_poi</span><span class="kc">nt</span><span class="err">_</span><span class="kc">features</span><span class="err">&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="err">&#39;</span><span class="kc">t</span><span class="err">oke</span><span class="kc">n</span><span class="err">&#39;</span><span class="p">:</span> <span class="err">&#39;b</span><span class="mi">4</span><span class="err">b</span><span class="mi">81</span><span class="err">c</span><span class="kc">f</span><span class="err">d</span><span class="mi">5</span><span class="err">d</span><span class="mi">734881</span><span class="err">ad</span><span class="mf">386e5</span><span class="err">c</span><span class="mi">2</span><span class="err">b</span><span class="mf">00e</span><span class="err">d</span><span class="mi">4</span><span class="err">a&#39;</span><span class="p">}}]</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">num_class</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;car&quot;</span><span class="p">]),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">num_class</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;truck&quot;</span><span class="p">,</span> <span class="s2">&quot;construction_vehicle&quot;</span><span class="p">]),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">num_class</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bus&quot;</span><span class="p">,</span> <span class="s2">&quot;trailer&quot;</span><span class="p">]),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">num_class</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;barrier&quot;</span><span class="p">]),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">num_class</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;motorcycle&quot;</span><span class="p">,</span> <span class="s2">&quot;bicycle&quot;</span><span class="p">]),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">num_class</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pedestrian&quot;</span><span class="p">,</span> <span class="s2">&quot;traffic_cone&quot;</span><span class="p">]),</span>
<span class="p">]</span>
</pre></div>
<p>六种种类一个batch_size</p><p>猜想输出为regression，height-above-ground，dimension，rotation，velocity，heat-map</p><p>H,W为180</p><p>batch_box_preds：tensor[(1, 32400, 9)]，32400=180*180，9=xs(1)+ys(1)+batch_hei(1)+batch_dim(3)+batch_vel(2)+batch_rot(1)</p><p>dataloader处理后的数据为{'metadata': {'image_prefix': PosixPath('data/nuScenes'), 'num_point_features': 5, 'token': 'e411f0ab3a0243f1bea593bed340894f'}, 'points':（点数，5）, 'voxels'（体素数，10，5）:'shape': array([1440, 1440,   40]), 'num_points': 表示每个体素中的点云数量), 'num_voxels': 体素数), 'coordinates': (体素数，3)array([[ 16, 717, 682],
       [ 16, 717, 680],
       [ 16, 717, 678],
       ...,
       [ 28, 701, 636],
       [ 28, 701, 641],
       [ 28, 702, 638]], dtype=int32)}</p><p>每个体素最多10个点</p><p>NuScenes数据集中lidar文件名用时间戳区分文件</p><figure style="flex: 152.0700636942675" ><img width="955" height="314" src="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/archives/assets/87d8a3786a8d11c4cb570194d941f95d.png" /></figure>
<pre><code>汽车编号-时间-相机位置-时间戳.jpg
汽车编号-时间-雷达位置-时间戳.pcd.bin
</code></pre>
<p>'num_point_features'：前4个是点feature，一般是xyz和反射率，后一个是时间信息</p><p>‘feature_map_size’：180*180</p><p>for i，data in enumerate（dataloader）：一次性导入num_work个batch</p><p>Sparse Convolution成功用于3D目标检测的网络，相比于3D Convolution，在运算速度和显存消耗中有巨大的优势。</p><p>python前r表示禁止转义</p><p>backbone中对于feature进行卷积，体素数减少，最后dense生成密集要求size的vector</p><p>使用token对应相关的图片，主要看create_date时对数据集做的处理，每个数据有对应的lidar_path和info[“sweeps”]包含9个另外的雷达数据文件，邻近的</p><p>data中point是10个lidar文件中的点拼接在一起，第一个文件读入的为最大的时间戳</p>
<pre><code>./data/nuScenes/samples/LIDAR_TOP/n015-2018-10-08-15-44-23+0800__LIDAR_TOP__1538984706547894.pcd.bin
./data/nuScenes/sweeps/LIDAR_TOP/n015-2018-10-08-15-44-23+0800__LIDAR_TOP__1538984706497583.pcd.bin
./data/nuScenes/sweeps/LIDAR_TOP/n015-2018-10-08-15-44-23+0800__LIDAR_TOP__1538984706447789.pcd.bin
./data/nuScenes/sweeps/LIDAR_TOP/n015-2018-10-08-15-44-23+0800__LIDAR_TOP__1538984706397490.pcd.bin
./data/nuScenes/sweeps/LIDAR_TOP/n015-2018-10-08-15-44-23+0800__LIDAR_TOP__1538984706347725.pcd.bin
./data/nuScenes/sweeps/LIDAR_TOP/n015-2018-10-08-15-44-23+0800__LIDAR_TOP__1538984706297399.pcd.bin
./data/nuScenes/sweeps/LIDAR_TOP/n015-2018-10-08-15-44-23+0800__LIDAR_TOP__1538984706247624.pcd.bin
./data/nuScenes/sweeps/LIDAR_TOP/n015-2018-10-08-15-44-23+0800__LIDAR_TOP__1538984706197302.pcd.bin
./data/nuScenes/sweeps/LIDAR_TOP/n015-2018-10-08-15-44-23+0800__LIDAR_TOP__1538984706147531.pcd.bin
./data/nuScenes/sweeps/LIDAR_TOP/n015-2018-10-08-15-44-23+0800__LIDAR_TOP__1538984706097778.pcd.bin
</code></pre>
<p>第一个文件为samples中的lidar文件，后面取9个sweeps中文件，这是中间过程中收集的数据（sensor data for intermediate frames），即第一个lidar文件融合了后面9个文件的信息，预测对应第一个文件的信息，之后跟踪中使用samples下的图片文件，和对应token的lidar文件预测结果经行跟踪</p>
<pre><code>前十次跟踪输出：
输出的含义
last_time_stamp time_lag
detect到的物体数

1533201470.448696 0.0
236
1533201470.448696 0.49932193756103516
151
1533201470.9480178 0.49931812286376953
149
1533201471.447336 0.4998810291290283
139
1533201471.947217 0.5009839534759521
161
1533201472.448201 0.4506669044494629
172
1533201472.8988678 0.5004310607910156
211
1533201473.399299 0.5004289150238037
208
1533201473.8997278 0.5501871109008789
205
1533201474.449915 0.4993429183959961
176
1533201474.9492579 0.5004210472106934
142
</code></pre>
<p>sample中为key_frame， A keyframe is a frame where the time-stamps of data from all the sensors should be very close to the time-stamp of the sample it points to.</p><p>最终output的构成['box3d_lidar']：shape（物体数，9），['scores']：（物体数），['label_preds']：（物体数）</p><p>修改只使用部分数据集</p><p>代码修改</p><p>文件：==mmdetection3d/tools/data_converter/nuscenes_converter.py==</p><p>函数：==_fill_trainval_infos==</p><div class="highlight"><pre><span></span><span class="c1">#update for part1_dataset     </span>
<span class="c1"># for sample in mmcv.track_iter_progress(nusc.sample):     for sample in mmcv.track_iter_progress(nusc.sample[0:3376]):</span>
</pre></div>
<p>数据处理</p><div class="highlight"><pre><span></span><span class="c1"># 官方 </span>
<span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">create_data</span><span class="o">.</span><span class="n">py</span> <span class="n">nuscenes</span> <span class="o">--</span><span class="n">root</span><span class="o">-</span><span class="n">path</span> <span class="o">./</span><span class="n">data</span><span class="o">/</span><span class="n">nuscenes</span> <span class="o">--</span><span class="n">out</span><span class="o">-</span><span class="nb">dir</span> <span class="o">./</span><span class="n">data</span><span class="o">/</span><span class="n">nuscenes</span> <span class="o">--</span><span class="n">extra</span><span class="o">-</span><span class="n">tag</span> <span class="n">nuscenes</span>
</pre></div>
<p>至此，数据处理部分完成</p><p>（三）训练评价</p><p>这里以CenterPoint举例【单GPU】</p><p>训练</p><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">train</span><span class="o">.</span><span class="n">py</span> <span class="n">configs</span><span class="o">/</span><span class="n">centerpoint</span><span class="o">/</span><span class="n">centerpoint_02pillar_second_secfpn_4x8_cyclic_20e_nus</span><span class="o">.</span><span class="n">py</span>
</pre></div>
<p>评价</p><blockquote>
<ul>
<li>out: 存储预测结果  -</li>
<li>eval: 调用nuscenes官方评价方法NuScenesEval，因此仅包含Part1部分数据集，会导致报错。</li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">tools</span><span class="o">/</span><span class="n">test</span><span class="o">.</span><span class="n">py</span> <span class="n">configs</span><span class="o">/</span><span class="n">centerpoint</span><span class="o">/</span><span class="n">centerpoint_02pillar_second_secfpn_4x8_cyclic_20e_nus</span><span class="o">.</span><span class="n">py</span> <span class="n">work_dir</span><span class="o">/</span><span class="n">centerpoint</span><span class="o">/</span><span class="n">epoch_10</span><span class="o">.</span><span class="n">pth</span> <span class="o">--</span><span class="nb">eval</span> <span class="n">bbox</span> <span class="o">--</span><span class="n">out</span> <span class="o">./</span><span class="n">eval_results</span><span class="o">/</span><span class="n">centerpoint</span><span class="o">.</span><span class="n">pkl</span>
</pre></div>
<ol>
<li><p>报错分析</p><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;/home/ch511/anaconda3/envs/open-mmlab/lib/python3.7/site-packages/nuscenes/eval/detection/evaluate.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">87</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__init__</span>     
<span class="s2">&quot;Samples in split doesn&#39;t match samples in predictions.&quot;</span> <span class="ne">AssertionError</span><span class="p">:</span> <span class="n">Samples</span> <span class="ow">in</span> <span class="n">split</span> <span class="n">doesn</span><span class="s1">&#39;t match samples in predictions.</span>
</pre></div>
<p>报错代码：</p><div class="highlight"><pre><span></span><span class="c1"># evaluate.py </span>
<span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pred_boxes</span><span class="o">.</span><span class="n">sample_tokens</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gt_boxes</span><span class="o">.</span><span class="n">sample_tokens</span><span class="p">),</span> \             <span class="s2">&quot;Samples in split doesn&#39;t match samples in predictions.&quot;</span>
</pre></div>
<p>报错原因：</p><blockquote>
<p>self.pred_boxes.sample_tokens = 914，self.gt_boxes.sample_tokens = 6019</p></blockquote>
<p>真实值包括整个数据集，但我仅使用了part1数据集.</p></li>
<li><p>代码修改：</p><p>文件：/home/ch511/anaconda3/envs/open-mmlab/lib/python3.7/site-packages/nuscenes/eval/common/loaders.py</p><p>函数：load_gt  sample_tokens_all = [s['token'] for s in nusc.sample[0:3376]]</p><blockquote>
<p>修改源码并非一个好办法，最好是self.nusc仅包括part1部分，这样加载数据时也会更快一些。【待更新】</p></blockquote>
<p>（四）其他说明</p><p>nusc = NuScenes(version=self.version, dataroot=self.data_root, verbose=False)</p><p>上述操作较为耗费时间，因此我把它存储为outputs/nusc/data_false_verbose.pkl文件。每次使用时读取即可。</p></li>
</ol>
<blockquote>
<p>tools/single_inference.py is just for single lidar frame inference, got one frame data. output the detection results.</p></blockquote>
<blockquote>
<p>tools/multi_sweep_inference.py is for multi_sweep lidar data concat to inference.</p></blockquote>
<p>notice that it will use ego vehicle odometry infos, because it concat the multi-frame lidar into one frame, just like the training process doing, it will get better performance if the DL model are trained on multi-sweeps (e.g. Nuscesnes dataset devekit usually using 10sweeps concate on training)</p><p>nuScenes lidar is 32 lanes and Waymo is 64 lanes. As nuScenes produces really sparse pointcloud, we use more frames to aggregate data. For Waymo, we can also do 5 or ten but it is slower.</p><ol>
<li>Waymo has larger scene (150x150 vs. 100 x 100meter).</li>
<li>The Waymo model's output stride is 1 compared to 4 in nuScenes. (Waymo with output stride 4 doesn't perform well)</li>
</ol>
<p>centerpoint+pointpainted将图片信息融合到点云中</p><p>选择nsweep=1可以只使用samples中的图片</p><p>只使用trainval01的数据集时容易因为token找不到无法寻找数据（不建议修改json文件）</p><p>==输出掩码mask和稀疏卷积后的特征，取两帧数据进行costvolum==</p><p>仔细看生成体素的过程，为什么是不一样的点数</p><p>==voxel_num = _points_to_voxel_reverse_kernel()==这个就是最后的体素数</p><div class="highlight"><pre><span></span><span class="n">failed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">failed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">coors_range</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">voxel_size</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="c1"># 判断是否在规定的coor内</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">&gt;=</span> <span class="n">grid_size</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">failed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="n">coor</span><span class="p">[</span><span class="n">ndim_minus_1</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span> <span class="c1"># xyz倒过来了</span>
        <span class="k">if</span> <span class="n">failed</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">voxelidx</span> <span class="o">=</span> <span class="n">coor_to_voxelidx</span><span class="p">[</span><span class="n">coor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coor</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coor</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="c1"># 一开始是-1</span>
        <span class="k">if</span> <span class="n">voxelidx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># 说明没有点</span>
            <span class="n">voxelidx</span> <span class="o">=</span> <span class="n">voxel_num</span>
            <span class="k">if</span> <span class="n">voxel_num</span> <span class="o">&gt;=</span> <span class="n">max_voxels</span><span class="p">:</span>
                <span class="k">continue</span> 
            <span class="n">voxel_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">coor_to_voxelidx</span><span class="p">[</span><span class="n">coor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coor</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coor</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">voxelidx</span> <span class="c1"># 更改，说明取了点</span>
            <span class="n">coors</span><span class="p">[</span><span class="n">voxelidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">coor</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">num_points_per_voxel</span><span class="p">[</span><span class="n">voxelidx</span><span class="p">]</span> <span class="c1"># 一开始是0说明这个voxel取了几个点</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="n">max_points</span><span class="p">:</span>
            <span class="n">voxels</span><span class="p">[</span><span class="n">voxelidx</span><span class="p">,</span> <span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c1"># voxelidx取的第几个点是point[i]</span>
            <span class="n">num_points_per_voxel</span><span class="p">[</span><span class="n">voxelidx</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">voxel_num</span>
</pre></div>
<p>速度的生成过程：</p><figure style="flex: 73.21041214750542" ><img width="675" height="461" src="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/archives/assets/c814239e273c11c204cea06dee050bba.png" /></figure><p>Linear一般初始化为正态分布，bias初始化为0</p><p>追踪时使用一个场景下的照片进行跟踪，之后再训练</p><p>追踪的loss是每个序列场景中的，或者每次跟踪之后进行一次loss计算</p><p>每次更新坐标把物体的速度加上，更改他是位置，z的位置也加上去</p><p>trainloader返回的大小要一样，否则无法用于batch叠加</p>
            </div>
        </article>
        <div id="ga-tags">
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/Blog/tag/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">#深度学习</a>
    </span>
    
</div>
    </section>
    
<section id="ga-content_pager">

    <div class="next">
        <a class="ga-highlight" href="/Blog/archives/%E5%90%8E%E5%8F%B0/">后台和传输任务</a>
        <p class="yue">后台任务的启动</p>
    </div>


    <div class="prev">
        <a class="ga-highlight" href="/Blog/archives/3DtrackingOnNuScences/">3D Tracking on NuScences</a>
        <p class="yue">项目学习</p>
    </div>

</section>


    

</main>

                <footer class="ga-mono" id="ga-footer">
                    <section>
                        <span id="ga-uptime"></span>
                        <span class="brand"><a no-style href="https://github.com/Arley517693777" target="_blank">我的个人博客</a></span>
                    </section>
                    <section>
                        <p class="copyright">
                            <span>Copyright © 2021 LSQ</span>
                            <span>Powered by <a no-style href="https://github.com/AlanDecode/Maverick" target="_blank">Maverick</a></span>
                        </p>
                        <div class="copyright">
                            <span class="footer-addon">
                                
                            </span>
                            <nav class="social-links">
                                <ul><li><a class="no-style" title="Twitter" href="https://twitter.com/lsq15" target="_blank"><i class="gi gi-twitter"></i>Twitter</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/LSQsjtu" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                            </nav>
                        </div>
                    </section>
                    <script>
                        var site_build_date = "2021-05-04T22:46+08:00"
                    </script>
                    <script src="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/assets/galileo-dc4baa7cf4.js"></script>
                </footer>
            </div>
        </div>
    </div>

    <!--katex-->
    <script defer src="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/assets/katex.min.js"></script>
    <script>
    mathOpts = {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\\[", right: "\\]", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\(", right: "\\)", display: false}
        ]
    };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    <script src="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog@gh-pages/assets/ExSearch/ExSearch-493cb9cd89.js"></script>

    
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/LSQsjtu/Blog/gotop/js/szgotop.js"></script>
<div class="back-to-top cd-top faa-float animated cd-is-visible" style="top: -999px;"></div>

    </body>
</html>